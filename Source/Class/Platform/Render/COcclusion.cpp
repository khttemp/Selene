

//-----------------------------------------------------------------------------------
// INCLUDE
//-----------------------------------------------------------------------------------
#include "Class/Platform/Render/CRender.h"
#include "Class/Platform/Render/COcclusion.h"


//-----------------------------------------------------------------------------------
// NAMESPACE
//-----------------------------------------------------------------------------------
using namespace Selene;
using namespace Renderer;


//-----------------------------------------------------------------------------------
/**
*/
//-----------------------------------------------------------------------------------
COcclusion::COcclusion( CRender *pRender )
	: m_pQuery	( NULL )
{
	pRender->CreateOcclusionQuery( m_pQuery );
}

//-----------------------------------------------------------------------------------
/**
*/
//-----------------------------------------------------------------------------------
COcclusion::~COcclusion()
{
	SAFE_RELEASE( m_pQuery );
}

//-----------------------------------------------------------------------------------
/**
*/
//-----------------------------------------------------------------------------------
void COcclusion::Begin( void )
{
	if ( m_pQuery != NULL )
	{
		m_pQuery->Issue( D3DISSUE_BEGIN );
	}
}

//-----------------------------------------------------------------------------------
/**
*/
//-----------------------------------------------------------------------------------
void COcclusion::End( void )
{
	if ( m_pQuery != NULL )
	{
		m_pQuery->Issue( D3DISSUE_END );
	}
}

//-----------------------------------------------------------------------------------
/**
*/
//-----------------------------------------------------------------------------------
Sint32 COcclusion::GetPixels( void )
{
	Sint32 PixelsVisible = 0;

	if ( m_pQuery != NULL )
	{
		while ( FAILED( m_pQuery->GetData( (void*)&PixelsVisible, sizeof(Sint32), D3DGETDATA_FLUSH ) ) );
	}

	return PixelsVisible;
}

